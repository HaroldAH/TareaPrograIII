CREATE TABLE Role (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(20),
    permissions VARCHAR(255)
);

CREATE TABLE User (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(20),
    email VARCHAR(100) UNIQUE,
    password VARCHAR(255),
    role_id BIGINT,
    FOREIGN KEY (role_id) REFERENCES Role(id)
);

CREATE TABLE Habit (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(20),
    category VARCHAR(50), -- valores: PHYSICAL, MENTAL, SLEEP, DIET
    description VARCHAR(100)
);

CREATE TABLE FavoriteHabit (
    user_id BIGINT,
    habit_id BIGINT,
    PRIMARY KEY (user_id, habit_id),
    FOREIGN KEY (user_id) REFERENCES User(id),
    FOREIGN KEY (habit_id) REFERENCES Habit(id)
);

CREATE TABLE Routine (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(100),
    user_id BIGINT,
    daysOfWeek VARCHAR(20),
    FOREIGN KEY (user_id) REFERENCES User(id)
);

CREATE TABLE RoutineActivity (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    routine_id BIGINT,
    habit_id BIGINT,
    duration INT, -- duraci√≥n en minutos
    targetTime VARCHAR(10), -- ejemplo: '07:30 AM', mejor VARCHAR para facilitar validaciones y uso con GraphQL
    notes VARCHAR(255),
    FOREIGN KEY (routine_id) REFERENCES Routine(id),
    FOREIGN KEY (habit_id) REFERENCES Habit(id)
);

CREATE TABLE ProgressLog (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT,
    routine_id BIGINT,
    date DATE,
    status ENUM('P', 'C'), -- P: Pendiente, C: Completado
    FOREIGN KEY (user_id) REFERENCES User(id),
    FOREIGN KEY (routine_id) REFERENCES Routine(id)
);

CREATE TABLE CompletedActivity (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    progress_log_id BIGINT,
    habit_id BIGINT,
    completedAt VARCHAR(10), -- hora completada, formato AM/PM
    notes VARCHAR(255),
    FOREIGN KEY (progress_log_id) REFERENCES ProgressLog(id),
    FOREIGN KEY (habit_id) REFERENCES Habit(id)
);

CREATE TABLE Guide (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(100),
    content TEXT,
    category ENUM('P', 'M', 'S', 'D') -- P: Physical, M: Mental, S: Sleep, D: Diet
);

CREATE TABLE Guide_Habit (
    guide_id BIGINT,
    habit_id BIGINT,
    PRIMARY KEY (guide_id, habit_id),
    FOREIGN KEY (guide_id) REFERENCES Guide(id),
    FOREIGN KEY (habit_id) REFERENCES Habit(id)
);

CREATE TABLE Reminder (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT,
    habit_id BIGINT,
    time VARCHAR(10), -- formato '18:00'
    frequency VARCHAR(20), -- DAILY, WEEKLY
    FOREIGN KEY (user_id) REFERENCES User(id),
    FOREIGN KEY (habit_id) REFERENCES Habit(id)
);

CREATE TABLE AuthToken (
    token VARCHAR(255) PRIMARY KEY,
    user_id BIGINT,
    expiresAt DATETIME,
    FOREIGN KEY (user_id) REFERENCES User(id)
);
